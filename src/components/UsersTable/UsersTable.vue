<template>
  <base-table
    v-if="data"
    :columns="columns"
    :data="data"
    :pagination="pagination"
    :search="search"
    :sorting="sorting"
    @change="handleChange"
  />
  <p v-if="isLoading">Loading</p>
</template>

<script>
import { computed, ref } from 'vue';
import BaseTable from '../BaseTable/BaseTable.vue';
import fetchData from '../../helpers/fetchData';

export default {
  name: 'UsersTable',
  components: {
    BaseTable,
  },
  props: {
    endpoint: {
      type: String,
      required: false,
      default: '',
    },
    search: {
      type: Boolean,
      required: false,
      default: false,
    },
    sorting: {
      type: Boolean,
      required: false,
      default: false,
    },
    pagination: {
      type: Boolean,
      required: false,
      default: false,
    },
  },
  setup(props) {
    const data = ref(null);
    const error = ref('');
    const isLoading = ref(true);

    const columns = computed(() => [
      { label: 'Name', value: 'name' },
      { label: 'Email', value: 'email' },
      { label: 'Company name', value: 'companyName' },
      { label: 'City', value: 'addressCity' },
      { label: 'Website', value: 'website' },
    ]);

    fetchData(props.endpoint, null, {
      resolve: (json) => {
        data.value = json.map((element) => ({
          ...element,
          companyName: element.company.name,
          addressCity: element.address.city,
        }));
      },
      reject: (errorMessage) => {
        error.value = errorMessage;
      },
      atLast: () => {
        isLoading.value = false;
      },
    });

    const handleChange = (newData) => {
      console.log(newData);
      data.value = newData;
    };

    return {
      columns,
      data,
      error,
      isLoading,
      handleChange,
    };
  },
};
</script>
<style lang="scss" scoped src="./UsersTable.scss" />
